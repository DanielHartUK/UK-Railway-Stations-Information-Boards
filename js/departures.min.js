function getTrains(){sIDs=[],rows=0;var a=0;$.get("php/getDepartures.php?station="+stationCode+"&rows="+departures,function(b){for("No response"===b?(rows+=3,responseError=!0,$(".departuresList").append('<div class="departureEntry error"><div class="departureRow"><p class="errorMessage">No reponse recieved.</p></div></div>'),$(".departuresList").append('<div class="departureEntry error"><div class="departureRow"><p class="errorMessage">Check station code is correct</p></div></div>'),$(".departuresList").append('<div class="departureEntry error"><div class="departureRow"><p class="errorMessage">and rate limit is not exceeded.</p></div></div>')):"No departures"===b?(rows++,0===$(".noDepartures").length&&$(".departuresList").append('<div class="departureEntry noDepartures"><div class="departureRow"><p class="errorMessage centre">No departures</p></div></div>')):b.length>0&&$.each(b,function(b,c){if(a++,a<=rowsPerPage*(page-1));else{if(a>rowsPerPage*page)return!1;var d=sanitizeID(c.serviceID);if(rows++,sIDs.push(c.serviceID),0===$("#"+d).length){var e='<div class="departureEntry" id="'+d+'" data-serviceID="'+c.serviceID+'">';if(e+='<div class="departureRow">',e+='<p class="std">',null!=c.std&&(e+=c.std),e+="</p>",e+='<p class="destinationName">',null!=c.destination.location)if(c.destination.location.length>1){var f=0;$.each(c.destination.location,function(a,b){0!=f&&(e+=" &amp; "),e+='<a href="?station='+b.crs+'">'+b.locationName+"</a>",f++})}else e+='<a href="?station='+c.destination.location.crs+'">'+c.destination.location.locationName+"</a>";e+="</p>",e+='<p class="platform">',"train"!=c.serviceType?e+=c.serviceType:null!=c.platform&&(e+=c.platform),e+="</p>",e+='<p class="etd">',null!=c.etd&&(e+=c.etd),e+="</p>",e+="</div>",e+="</div>",$(".departuresList").append(e)}else{var g=$("#"+d),h="";if(null!=c.destination.location)if(h="",c.destination.location.length>1){var f=0;$.each(c.destination.location,function(a,b){0!=f&&(h+=" &amp; "),h+='<a href="?station='+b.crs+'">'+b.locationName+"</a>",f++})}else h+='<a href="?station='+c.destination.location.crs+'">'+c.destination.location.locationName+"</a>";$(g).find(".destinationName").html()!=h.replace(" & "," &amp; ")&&$(g).find(".destinationName").html(h).addClass("departureUpdated"),h="","train"!=c.serviceType?h=c.serviceType:null!=c.platform&&(h=c.platform),$(g).find(".platform").html()!=h&&$(g).find(".platform").html(h).addClass("departureUpdated"),h="",null!=c.etd&&(h=c.etd),$(g).find(".etd").html()!=h&&$(g).find(".etd").html(h)}}}),$.each($(".departureEntry:not(.empty, .error, .noDepartures)"),function(a,b){var c=$(b)[0].dataset.serviceid;NaN!=c&&sIDs.indexOf(c)===-1&&b.remove()}),$(".departureEntry.empty").remove();rows<rowsPerPage;)$(".departuresList").append('<div class="departureEntry empty"><div class="departureRow"><p class="delayReason">&nbsp;</p></div></div>'),rows++;for(;rows>rowsPerPage;)$(".departureEntry.empty").length>0&&$(".departuresList").find(".departureEntry.empty")[0].remove(),rows--;var c=Math.ceil(b.length/rowsPerPage);$(".page").text("Page "+page+" of "+c)})}var sIDs=[],rowsPerPage=27,pages=5,departures=rowsPerPage*pages;if(getQueryVariable("page"))var page=getQueryVariable("page");else var page=1;var rows,stationCode=getQueryVariable("station"),responseError=!1;getTrains();var sync=setInterval(function(){responseError===!1&&getSecs()%10===0?(clearInterval(sync),setInterval(getTrains,1e4)):responseError&&clearInterval(sync)},100);