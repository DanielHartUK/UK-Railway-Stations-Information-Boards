var sIDs=[],rowsPerPage=27;if(getQueryVariable("page"))var pages=getQueryVariable("pages");else pages=1;var rows,departures=rowsPerPage*pages;if(getQueryVariable("page"))var page=getQueryVariable("page");else page=1;var stationCode=getQueryVariable("station"),responseError=!1;function getTrains(){sIDs=[],rows=0;var e=0;$.get("get/getArrivals.php?station="+stationCode+"&rows="+departures,function(r){if($(".departureEntry.error, .departureEntry.noDepartures").remove(),"No response"===r)rows+=3,responseError=!0,$(".departuresList").append('<div class="departureEntry error"><div class="departureRow"><p class="errorMessage">No reponse recieved.</p></div></div>'),$(".departuresList").append('<div class="departureEntry error"><div class="departureRow"><p class="errorMessage">Check station code is correct</p></div></div>'),$(".departuresList").append('<div class="departureEntry error"><div class="departureRow"><p class="errorMessage">and rate limit is not exceeded.</p></div></div>');else if(null!=r.GetStationBoardResult){if(rows+=9,0===$(".noDepartures").length){for(i=0;i<7;i++)$(".departuresList").append('<div class="departureEntry noDepartures"><div class="departureRow"><p class="errorMessage centre"></p></div></div>');$(".departuresList").append('<div class="departureEntry noDepartures"><div class="departureRow"><p class="errorMessage centre">Welcome to</p></div></div>'),$(".departuresList").append('<div class="departureEntry noDepartures"><div class="departureRow"><p class="errorMessage centre">'+r.GetStationBoardResult.locationName+"</p></div></div>")}}else if(r.length>0){$.each(r,function(r,a){if(++e<=rowsPerPage*(page-1));else{if(e>rowsPerPage*page)return!1;var t=sanitizeID(a.serviceID);if(rows++,sIDs.push(a.serviceID),0===$("#"+t).length){var s='<div class="departureEntry" id="'+t+'" data-serviceID="'+a.serviceID+'">';if(s+='<div class="departureRow">',s+='<p class="std">',null!=a.sta&&(s+=a.sta),s+="</p>",s+='<p class="destinationName">',null!=a.origin.location)if(a.origin.location.length>1){var i=0;$.each(a.origin.location,function(e,r){0!=i&&(s+=" &amp; "),s+='<a href="?station='+r.crs+'">'+r.locationName+"</a>",i++})}else s+='<a href="?station='+a.origin.location.crs+'">'+a.origin.location.locationName+"</a>";s+="</p>",s+='<p class="platform">',"train"!=a.serviceType?s+=a.serviceType:null!=a.platform&&(s+=a.platform),s+="</p>",s+='<p class="etd">',null!=a.eta&&(s+=a.eta),s+="</p>",s+="</div>",s+="</div>",$(".departuresList").append(s)}else{var o=$("#"+t),n="";if(null!=a.origin.location)if(n="",a.origin.location.length>1){i=0;$.each(a.origin.location,function(e,r){0!=i&&(n+=" &amp; "),n+='<a href="?station='+r.crs+'">'+r.locationName+"</a>",i++})}else n+='<a href="?station='+a.origin.location.crs+'">'+a.origin.location.locationName+"</a>";$(o).find(".destinationName").html()!=n.replace(" & "," &amp; ")&&$(o).find(".destinationName").html(n).addClass("departureUpdated"),n="","train"!=a.serviceType?n=a.serviceType:null!=a.platform&&(n=a.platform),$(o).find(".platform").html()!=n&&$(o).find(".platform").html(n).addClass("departureUpdated"),n="",null!=a.eta&&(n=a.eta),$(o).find(".etd").html()!=n&&$(o).find(".etd").html(n)}}});var a=Math.ceil(r.length/rowsPerPage);$(".page").text("Page "+page+" of "+a)}for($.each($(".departureEntry:not(.empty, .error, .noDepartures)"),function(e,r){var a=$(r)[0].dataset.serviceid;NaN!=a&&-1===sIDs.indexOf(a)&&r.remove()}),$(".departureEntry.empty").remove();rows<rowsPerPage;)$(".departuresList").append('<div class="departureEntry empty"><div class="departureRow"><p class="delayReason">&nbsp;</p></div></div>'),rows++;for(;rows>rowsPerPage;)$(".departureEntry.empty").length>0&&$(".departuresList").find(".departureEntry.empty")[0].remove(),rows--})}getTrains();var sync=setInterval(function(){!1===responseError&&getSecs()%10==0?(clearInterval(sync),setInterval(getTrains,1e4)):responseError&&clearInterval(sync)},100);