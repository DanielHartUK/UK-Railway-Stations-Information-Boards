var sIDs=[],stationCode=getQueryVariable("station"),platform=getQueryVariable("platform").toUpperCase(),futureDepartures=getQueryVariable("futDep"),showTime=getQueryVariable("time");if(null!=getQueryVariable("rows")&&parseInt(getQueryVariable("rows"))<4)var rows=parseInt(getQueryVariable("rows"));else rows=3;var r,nextRow,calling,responseError=!1,wipeHTML='<div class="wipe"></div>';function getTrains(t){sIDs=[],$.get("assets/getDeparturesPlatformTest1.json",function(e){if($(".departureEntry.error, .departureEntry.noDepartures").remove(),"No response"===e)responseError=!0;else if(null!=e.GetStationBoardResult)$(".noDepartures").length;else if(e[platform].length>0)if(null!=e[platform][0]){var l=e[platform][0];if(r=l,$(".platformBoard .row:nth-child(1)").attr("id")!=sanitizeID(l.serviceID)&&console.log("s changed"),$(".platformBoard .row:nth-child(1)").html(wipeHTML+departureHTML(l,1)).attr("id",sanitizeID(l.serviceID)),null!=l.subsequentCallingPoints){var a='<p class="callingTitle">Calling at: </p><div class="callingListCont"><p>',n="";if(Array.isArray(l.subsequentCallingPoints.callingPointList)){var i=l.subsequentCallingPoints.callingPointList.length;$.each(l.subsequentCallingPoints.callingPointList,function(t,e){n+=callingPoints(e.callingPoint),t!=i-1&&(n+=", ")})}else n+=callingPoints(l.subsequentCallingPoints.callingPointList.callingPoint);a+=n,a+="</p></div>",$(".platformBoard .row:nth-child(2) div p").html()!=n&&$(".platformBoard .row:nth-child(2)").html(wipeHTML+a),calling=!0}else calling=!1;"true"===futureDepartures&&(nextRow=calling?3:2,null!=e[platform][1]&&(calling&&3===rows||!calling)&&($(".platformBoard .row:nth-child("+nextRow+")").html(wipeHTML+departureHTML(e[platform][1],2)).attr("id",sanitizeID(e[platform][1].serviceID)),nextRow++),null==e[platform][2]||calling||3!==rows||($(".platformBoard .row:nth-child("+nextRow+")").html(wipeHTML+departureHTML(e[platform][2],3)).attr("id",sanitizeID(e[platform][2].serviceID)),nextRow++))}else console.log("no dep");"function"==typeof t&&t()})}function departureHTML(t,e){var r="";if("true"===futureDepartures&&(r+='<p class="depNo">',r+=1===e?"1st":2===e?"2nd":3===e?"3rd":e+"th",r+="</p>"),r+='<p class="std">',null!=t.std&&(r+=t.std),r+="</p>",r+='<p class="destinationName">',null!=t.destination.location)if(t.destination.location.length>1){var l=0;$.each(t.destination.location,function(t,e){0!=l&&(r+=" &amp; "),r+=e.locationName,l++})}else r+=t.destination.location.locationName;return r+="</p>",r+='<p class="etd">',null!=t.etd&&(r+=t.etd),r+="</p>"}function callingPoints(t){var e="";if(Array.isArray(t)){var r=t.length;$.each(t,function(t,l){t===r-1?e+=", and ":t>0&&(e+=", "),e+=l.locationName})}else{e+=t.locationName}return e}function scrollCalling(){var t=$(".callingListCont p");t.outerWidth()>t.parent().width()?(t.css("left","1510px"),scrollAnimation(t,.2,scrollCalling)):t.css("transition","").css("left","0")}"true"===futureDepartures&&$(".platformBoard").addClass("futDep"),"true"===showTime&&$(".time").show();var sync=setInterval(function(){!1===responseError&&getSecs()%10==0?clearInterval(sync):responseError&&clearInterval(sync)},100);getTrains(scrollCalling);